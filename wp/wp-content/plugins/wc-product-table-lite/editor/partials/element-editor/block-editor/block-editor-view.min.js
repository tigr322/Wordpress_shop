(function(e,t){t.parent,t.render=function(){var t=this.parent.$elm,a=this.parent,i=this,o=this.parent.model.get_data();if(t.empty(),e.each(o,function(r,s){var c=e('<div class="wcpt-block-editor-row" data-id="'+s.id+'">').data("wcpt-data",s),n=e("#wcpt-icon-sliders").length?e("#wcpt-icon-sliders").text():"*",l=e(n).addClass("wcpt-element-block__settings-icon");e.each(s.elements,function(t,a){var o=e('<div class="wcpt-element-block" data-type="'+a.type+'" data-id="'+a.id+'" title="Edit element settings">'+i.get_label(a)+l.get(0).outerHTML+"</div>");c.append(o.data("wcpt-data",a))});var p=e('<a href="#" class="wcpt-block-editor-add-element">+ Add element</a>');if(c.append(p),a.config.edit_row){var d=e("#wcpt-icon-sliders").length?e("#wcpt-icon-sliders").text():"*",_=e('<span class="wcpt-block-editor-edit-row" title="Edit row settings">'+d+"</span>");i.maybe_add_active_settings_class(_,s),c.append(_)}if(a.config.delete_row&&(o.length>1||void 0!==o[0].elements&&o[0].elements.length)){d=e("#wcpt-icon-trash-2").length?e("#wcpt-icon-trash-2").text():"x";var b=e('<span class="wcpt-block-editor-delete-row" title="Delete row">'+d+"</span>");c.append(b)}t.append(c)}),this.parent.config.add_row){var r=e('<a href="#" class="wcpt-block-editor-add-row">+ Add row</a>');t.append(r)}e(".wcpt-block-editor-row",t).length>1?t.sortable({items:".wcpt-block-editor-row",disabled:!1}):t.sortable({items:".wcpt-block-editor-row",disabled:!0});var s=this.parent.config.connect_with,c=t.closest(".wcpt-block-editor-lightbox-screen");c.length&&(s='[data-partial="'+c.attr("data-partial")+'"].wcpt-block-editor-lightbox-screen '+s),e(".wcpt-block-editor-row",t).sortable({items:".wcpt-element-block",connectWith:s,placeholder:"wcpt-element-block-placeholder",forcePlaceholderSize:!0,start:function(e,t){t.helper.width(t.helper.width()+1).height(""),t.placeholder.width(t.item.outerWidth()).addClass("wcpt-element-block")},sort:function(t,a){var i=e(t.target);if(i.closest(".wcpt-block-editor-lightbox-screen").length&&!/html|body/i.test(i.offsetParent()[0].tagName)){var o=t.pageY-i.offsetParent().offset().top-1.5*a.helper.outerHeight(!0);a.helper.css({top:o+"px"})}}})},t.maybe_add_active_settings_class=function(e,t){if(active_settings=!1,conditions=["custom_field_enabled","attribute_enabled","category_enabled","price_enabled","stock_enabled","product_type_enabled","store_timings_enabled","user_role_enabled"],t.condition&&conditions.forEach(e=>{t.condition[e]&&(active_settings=!0)}),t.style)for(const[e,a]of Object.entries(t.style))for(const[e,t]of Object.entries(a))t&&(active_settings=!0);active_settings?(e.addClass("wcpt-block-editor-edit-row--has-settings"),e.attr("title","The blue indicator shows this row has active style / condition settings")):(e.removeClass("wcpt-block-editor-edit-row--has-settings"),e.attr("title","This row has no active style or condition settings"))},t.lightbox=function(t){var a={$element:null,duplicate_remove:!0,attr:{}};e.extend(!0,a,t);var i=e('<div class="wcpt-block-editor-lightbox-screen"><div class="wcpt-block-editor-lightbox-content"></div></div>'),o=e('<div class="wcpt-block-editor-lightbox-tray"></div>'),r=e("#wcpt-icon-check").length?e("#wcpt-icon-check").text():"",s=e('<span class="wcpt-block-editor-lightbox-done" title="Done">'+r+"</span>"),c=e("#wcpt-icon-x").length?e("#wcpt-icon-x").text():"",n=e('<span class="wcpt-block-editor-lightbox-close" title="Close">'+c+"</span>"),l=e("#wcpt-icon-trash").length?e("#wcpt-icon-trash").text():"",p=e('<span class="wcpt-block-editor-lightbox-remove" title="Trash">'+l+"</span>"),d=e("#wcpt-icon-copy").length?e("#wcpt-icon-copy").text():"",_=e('<span class="wcpt-block-editor-lightbox-duplicate" title="Clone">'+d+"</span>");t.duplicate_remove?(o.append(s),o.append(_.add(p))):o.append(n),e("> .wcpt-block-editor-lightbox-content",i).append(o),e("body").append(i),i.data("wcpt-block-element",t.$element?t.$element:"").attr({"wcpt-controller":"edit-element-lightbox","wcpt-model-key":"block_element_data"}).attr(t.attr).children(".wcpt-block-editor-lightbox-content").append(e('script[data-wcpt-partial="'+t.partial+'"]').text()).end().show(),e("body").addClass("wcpt-be-lightbox-on");i.on("click",function(t){e(t.target).is(i)&&i.trigger("destroy")}),e("> .wcpt-block-editor-lightbox-content > .wcpt-block-editor-lightbox-tray > .wcpt-block-editor-lightbox-close, > .wcpt-block-editor-lightbox-content > .wcpt-block-editor-lightbox-tray > .wcpt-block-editor-lightbox-done",i).on("click",function(){i.trigger("destroy")}),i.on("destroy",function(){i.change(),i.remove(),e(".wcpt-block-editor-lightbox-screen").length||e("body").removeClass("wcpt-be-lightbox-on")});var b=e(".wcpt-block-editor-element-type-list__search__input",i);return b.on("keyup",function(){var t=e(this),a=t.val().trim().toLowerCase(),i=t.closest(".wcpt-block-editor-element-type-list"),o=e(".wcpt-block-editor-element-type",i);a?o.each(function(){var t=e(this),i=t.text().toLowerCase().trim();-1==i.indexOf(a)?t.hide():t.show()}):o.show()}),b.first().focus(),i},t.get_label=function(a){var i=a.type.replace(/(_|^)([^_]?)/g,function(e,t,a){return(t&&" ")+a.toUpperCase()}),o=i;switch(a.type){case"attribute":case"attribute_filter":a.attribute_name&&("_custom"==a.attribute_name&&a.custom_attribute_name?o=a.custom_attribute_name+" (custom)":(o=a.attribute_name,"object"==typeof window.wcpt_attributes&&e.each(window.wcpt_attributes,function(e,t){t.attribute_name==a.attribute_name&&(o=t.attribute_label)})),o="Attribute: <span>"+t.sanitize(o.charAt(0).toUpperCase()+o.substr(1))+"</span>");break;case"custom_field":case"custom_field_filter":a.field_name&&(o="Custom field: <span>"+t.sanitize(a.field_name)+"</span>");break;case"taxonomy":case"taxonomy_filter":a.taxonomy&&(o="Taxonomy: <span>"+t.sanitize(a.taxonomy)+"</span>");break;case"text":case"text__col":a.text?(o=t.sanitize(a.text),o.length>30&&(o=o.substring(0,30)+"..."),o='Text: <span>"'+o+'"</span>'):o="Text";break;case"html":case"html__col":a.html?(o=t.sanitize(a.html),o.length>20&&(o=o.substring(0,20)+"..."),o='HTML: <span>"'+o+'"</span>'):o="HTML";break;case"shortcode":if(a.shortcode){var r=a.shortcode;r.length>30&&(r=r.substring(0,30)+"..."),o="Shortcode: <span>"+t.sanitize(r)+"</span>"}break;case"sku":o="SKU";break;case"download_csv":o="Download CSV";break;case"media_image":case"media_image__col":o="Media Image";var s=a.use_external_source?a.external_source:a.url;if(s){var c=s.split("/").pop();c.length>10&&(c=c.substring(0,10)+"..."),o+=': <span>"'+c+'"</span>'}break;case"line_separator":o="← Line separator →";break;case"space":case"space__col":o="← Space →";break;case"product_id":o="Product ID";break;case"sorting":if(a.orderby){if(o="Sort by: <span>","meta_value_num"==a.orderby||"meta_value"==a.orderby)o+=" CF - "+a.meta_key;else if("id"==a.orderby)o+=" Product ID";else if("sku"==a.orderby)o+=" SKU as text";else if("sku_num"==a.orderby)o+=" SKU as integer";else if(-1!==e.inArray(a.orderby,["attribute","attribute_num"])&&a.orderby_attribute){var n=a.orderby_attribute;e.each(wcpt_attributes,function(e,t){if("pa_"+t.attribute_name==a.orderby_attribute)return n=t.attribute_label,!1}),o+=" Attribute - "+t.sanitize(n)}else o+=a.orderby[0].toUpperCase()+a.orderby.substring(1);o+="</span>"}break;case"search":if(a.target&&Array.isArray(a.target)&&a.target.length){if(1==a.target.length){var l=a.target[0];"attribute"==l&&a.attributes&&a.attributes.length&&(l+=": "+a.attributes.join(", ")),"custom_field"==l&&a.custom_fields&&a.custom_fields.length&&(l+=": "+a.custom_fields.join(", ")),"sku"==l&&(l="SKU")}else{var p=a.target.join(", ");p.length>45&&(p=p.substring(0,45)+"...");l="mixed "+a.target.length+" ("+p+")"}l=t.sanitize(l),l.length>70&&(l=l.substring(0,70)+"..."),o="Search: <span>"+l+"</span>"}break;case"apply_reset":o="Apply / Reset";break;case"date":case"date_picker_filter":if("date"==a.type?o="Date":"date_picker_filter"==a.type&&(o="Date Picker Filter"),a.date_source)if("publish_date"==a.date_source)o+=": <span>publish date</span>";else if("wordpress_custom_field"==a.date_source){var d="";a.custom_field_name&&(d=" ("+t.truncate(a.custom_field_name,15)+")"),o+=": <span>custom field"+d+"</span>"}else if("acf_custom_field"==a.date_source){d="";a.acf_field_name&&(d=" ("+t.truncate(a.acf_field_name,15)+")"),o+=": <span>acf"+d+"</span>"}break;case"regular_price__on_sale":o="Regular price";break;case"icon":case"icon__col":a.name&&(o='<img class="wcpt-icon-rep" src="'+wcpt_icons+a.name+'.svg">');break;case"dot":case"dot__col":o="⋅";break;case"select_variation":if(o="Select variation",void 0===a.display_type||"radio_single"==a.display_type)if(a.variation_name){var _=t.sanitize(a.variation_name);o="Select variation: <span>"+_+"</span>"}else o="Select variation: <span>*Single variation*</span>";else"radio_multiple"==a.display_type?o="Select variation: <span>*Radio buttons*</span>":"dropdown"==a.display_type&&(o="Select variation: <span>*Dropdown*</span>")}if(2==a.type.split("__").length&&-1==e.inArray(a.type,["space__col","text__col","html__col","media_image__col","icon__col","dot__col"])){var b=a.type.split("__")[0];o=b.charAt(0).toUpperCase()+b.slice(1).replace("_"," ")}return t.sanitize_preserve_span_and_image(o)},t.mark_elm=function(e,t){var a,i=this.parent.$elm,o=i.children(".wcpt-block-editor-row").eq(e);if(o.length){var r=o.children(".wcpt-element-block").eq(t);a=r.length?r:o}a.addClass("wcpt-be-mark"),setTimeout(function(){a.removeClass("wcpt-be-mark")},1250)},t.sanitize=function(e,t){if(t){e=e.replace(/<span>/g,"{span_open}").replace(/<\/span>/g,"{span_close}");var a=/<img[^<]+?>/gim,i=e.match(a),o=[];if(i)for(var r=0;r<i.length;r++)o.push(i[r]),e=e.replace(i[r],"#img-placeholder-"+r+"#")}if(e=e.replace(/</g,"&lt;").replace(/>/g,"&gt;"),t&&(e=e.replace(/{span_open}/g,"<span>").replace(/{span_close}/g,"</span>"),i))for(r=0;r<i.length;r++)e=e.replace("#img-placeholder-"+r+"#",i[r]);return e},t.sanitize_preserve_span_and_image=function(e){return t.sanitize(e,!0)},t.truncate=function(e,t){return t||(t=20),e.length>t&&(e=e.substring(0,t)+"..."),e}})(jQuery,WCPT_Block_Editor.View);